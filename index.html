<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ionen Master: Oktettregel & Ionenbildung</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .tap-active:active { transform: scale(0.97); transition: transform 0.1s; }
        .no-select { user-select: none; -webkit-user-select: none; }
        
        input[type="number"], input[type="text"] { -moz-appearance: textfield; font-size: 1.1rem; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .tab-content { display: none; animation: fadeIn 0.3s ease-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Atom-Visualisierung */
        .atom-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        .nucleus {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f97316, #ea580c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
            z-index: 10;
        }
        .shell {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px dashed #cbd5e1;
            border-radius: 50%;
        }
        .shell-1 { width: 70px; height: 70px; }
        .shell-2 { width: 105px; height: 105px; }
        .shell-3 { width: 140px; height: 140px; }
        .shell-4 { width: 175px; height: 175px; }
        
        .electron {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.5);
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }
        .electron.valence {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.5);
        }
        
        .hint-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .option-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 12px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-btn:hover { border-color: #3b82f6; }
        .option-btn:disabled { opacity: 0.7; cursor: not-allowed; }
        .option-btn.correct { background: #dcfce7; border-color: #22c55e; }
        .option-btn.wrong { background: #fee2e2; border-color: #ef4444; }
    </style>
</head>
<body class="pb-32 text-slate-800 bg-slate-100">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-4xl mx-auto p-3">
            <div class="flex items-center justify-between mb-3">
                <h1 class="text-lg font-black text-slate-800">‚öõÔ∏è IONEN MASTER</h1>
                <div class="flex items-center gap-2">
                    <div class="text-xs text-slate-500">XP:</div>
                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-1 rounded-full text-sm font-bold" id="total-xp">0</div>
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <div class="bg-slate-200 p-1 rounded-xl flex font-bold text-xs gap-1">
                <button onclick="switchTab('basics')" id="btn-basics" class="flex-1 py-2 px-2 rounded-lg bg-white shadow-sm text-blue-600 transition-all tap-active">üéØ Basics</button>
                <button onclick="switchTab('ionen')" id="btn-ionen" class="flex-1 py-2 px-2 rounded-lg text-slate-500 transition-all tap-active">‚ö° Ionen</button>
                <button onclick="switchTab('salze')" id="btn-salze" class="flex-1 py-2 px-2 rounded-lg text-slate-500 transition-all tap-active">üß™ Salze</button>
                <button onclick="switchTab('challenge')" id="btn-challenge" class="flex-1 py-2 px-2 rounded-lg text-slate-500 transition-all tap-active">üèÜ Quiz</button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-3 mt-4">

        <!-- ==================== BASICS TAB ==================== -->
        <div id="content-basics" class="tab-content active space-y-6">
            
            <!-- 1. Zuordnung: Au√üenelektronen -->
            <section class="bg-white rounded-2xl shadow-sm p-4 border-l-4 border-blue-500">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="font-bold text-slate-800 flex items-center gap-2"><span>üß©</span> Au√üenelektronen zuordnen</h2>
                    <button onclick="resetMatching()" class="text-xs bg-slate-100 hover:bg-slate-200 px-3 py-1 rounded-lg tap-active">üîÑ Neu</button>
                </div>
                <p class="text-sm text-slate-600 mb-3">Verbinde Element mit Anzahl der Au√üenelektronen!</p>
                <div class="grid grid-cols-2 gap-2" id="match-grid"></div>
            </section>

            <!-- 2. Interaktives Schalenmodell -->
            <section class="bg-white rounded-2xl shadow-sm p-4 border-l-4 border-green-500">
                <h2 class="font-bold text-slate-800 mb-2 flex items-center gap-2"><span>‚öõÔ∏è</span> Schalenmodell erkunden</h2>
                <p class="text-sm text-slate-600 mb-3">W√§hle ein Element!</p>
                
                <div class="flex gap-2 mb-4 flex-wrap">
                    <button onclick="showAtom('Li')" class="atom-btn bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-xs font-bold tap-active">Li (3)</button>
                    <button onclick="showAtom('O')" class="atom-btn bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-xs font-bold tap-active">O (8)</button>
                    <button onclick="showAtom('Na')" class="atom-btn bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs font-bold tap-active">Na (11)</button>
                    <button onclick="showAtom('Cl')" class="atom-btn bg-cyan-100 text-cyan-800 px-3 py-1 rounded-full text-xs font-bold tap-active">Cl (17)</button>
                    <button onclick="showAtom('K')" class="atom-btn bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-bold tap-active">K (19)</button>
                    <button onclick="showAtom('Ca')" class="atom-btn bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold tap-active">Ca (20)</button>
                </div>
                
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <div class="atom-container" id="atom-visual">
                        <div class="shell shell-1" id="shell1"></div>
                        <div class="shell shell-2" id="shell2"></div>
                        <div class="shell shell-3" id="shell3"></div>
                        <div class="shell shell-4" id="shell4"></div>
                        <div class="nucleus" id="nucleus-label">Na</div>
                        <div id="electrons-container"></div>
                    </div>
                    <div class="text-center mt-4">
                        <div class="text-sm text-slate-600">Elektronenverteilung:</div>
                        <div class="text-xl font-bold font-mono text-slate-800" id="shell-config">2 | 8 | 1</div>
                        <div class="mt-2 text-sm"><span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-1"></span> = Au√üenelektronen</div>
                    </div>
                </div>
            </section>

            <!-- 3. Valenzelektronen-Quiz -->
            <section class="bg-white rounded-2xl shadow-sm p-4 border-l-4 border-purple-500">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="font-bold text-slate-800 flex items-center gap-2"><span>üéØ</span> Valenzelektronen-Quiz</h2>
                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded font-mono" id="valence-score">Richtig: 0</span>
                </div>
                <p class="text-sm text-slate-600 mb-3">Wie viele Au√üenelektronen hat das Element?</p>
                
                <div class="bg-purple-50 p-6 rounded-xl border border-purple-200 text-center mb-4">
                    <div class="text-5xl font-black text-purple-800 mb-2" id="valence-element">Na</div>
                    <div class="text-sm text-purple-600" id="valence-info">Ordnungszahl: 11</div>
                </div>
                
                <div class="grid grid-cols-4 gap-2 mb-3" id="valence-options"></div>
                
                <div id="valence-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                <button onclick="nextValence()" id="valence-next" class="w-full bg-purple-200 text-purple-800 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
            </section>

            <!-- 4. Edelgas-Ziel -->
            <section class="bg-slate-800 text-white rounded-2xl shadow-lg p-5 border-t-4 border-yellow-400">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold flex items-center gap-2"><span>üëë</span> Edelgas-Ziel</h2>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded" id="oktet-score">Richtig: 0</span>
                </div>
                
                <div class="bg-white/10 rounded-xl p-4 border border-white/20">
                    <div class="text-base mb-3 font-medium" id="oktet-question">Lade...</div>
                    
                    <div class="hint-box text-slate-800 text-sm mb-3">
                        <b>üí° Oktettregel:</b> Atome streben 8 Au√üenelektronen an (wie Edelgase).
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2" id="oktet-options"></div>
                    
                    <div id="oktet-feedback" class="mt-3 hidden p-3 rounded-lg text-sm"></div>
                    <button onclick="nextOktet()" id="oktet-next" class="w-full mt-3 bg-slate-600 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
                </div>
            </section>
        </div>

        <!-- ==================== IONEN TAB ==================== -->
        <div id="content-ionen" class="tab-content space-y-6">

            <!-- 1. Kation oder Anion? -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-red-500 to-blue-500 p-3 text-white flex justify-between items-center">
                    <h2 class="font-bold flex items-center gap-2"><span>‚ö°</span> Kation oder Anion?</h2>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="iontype-score">Richtig: 0</span>
                </div>
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-4 text-center">Wird das Atom zum Kation (+) oder Anion (‚àí)?</p>
                    
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 text-center mb-4">
                        <div class="text-4xl font-black text-slate-800 mb-2" id="iontype-element">Na</div>
                        <div class="text-sm text-slate-600" id="iontype-info">1 Au√üenelektron</div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <button onclick="checkIonType('kation')" id="btn-kation" class="p-4 rounded-xl border-2 border-red-200 bg-red-50 hover:border-red-400 tap-active transition-all">
                            <div class="text-3xl mb-1">‚ûï</div>
                            <div class="font-bold text-red-700">Kation</div>
                            <div class="text-xs text-red-500">gibt e‚Åª ab</div>
                        </button>
                        <button onclick="checkIonType('anion')" id="btn-anion" class="p-4 rounded-xl border-2 border-blue-200 bg-blue-50 hover:border-blue-400 tap-active transition-all">
                            <div class="text-3xl mb-1">‚ûñ</div>
                            <div class="font-bold text-blue-700">Anion</div>
                            <div class="text-xs text-blue-500">nimmt e‚Åª auf</div>
                        </button>
                    </div>
                    
                    <div id="iontype-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                    <button onclick="nextIonType()" id="iontype-next" class="w-full bg-slate-200 text-slate-700 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
                </div>
            </section>

            <!-- 2. Ionenladung bestimmen -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-amber-500 to-orange-500 p-3 text-white flex justify-between items-center">
                    <h2 class="font-bold flex items-center gap-2"><span>üî¢</span> Ionenladung bestimmen</h2>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="charge-score">Richtig: 0</span>
                </div>
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-3 text-center">Welche Ladung hat das Ion?</p>
                    
                    <div class="bg-amber-50 p-4 rounded-xl border border-amber-200 text-center mb-4">
                        <div class="text-4xl font-black text-amber-800 mb-1" id="charge-element">Mg</div>
                        <div class="text-sm text-amber-600" id="charge-info">2 Au√üenelektronen ‚Üí gibt 2 e‚Åª ab</div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-2 mb-3" id="charge-options"></div>
                    
                    <div id="charge-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                    <button onclick="nextCharge()" id="charge-next" class="w-full bg-amber-200 text-amber-800 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
                </div>
            </section>

            <!-- 3. Ionenschreibweise -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-emerald-500 to-teal-500 p-3 text-white flex justify-between items-center">
                    <h2 class="font-bold flex items-center gap-2"><span>‚úçÔ∏è</span> Ionenschreibweise</h2>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="notation-score">Richtig: 0</span>
                </div>
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-3 text-center">W√§hle die richtige Schreibweise!</p>
                    
                    <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-200 mb-4 text-center">
                        <span class="text-2xl font-bold text-emerald-800" id="notation-element">Natrium</span>
                        <span class="text-lg text-emerald-600"> ‚Üí Ion mit Ladung </span>
                        <span class="text-2xl font-bold text-emerald-800" id="notation-charge">+1</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mb-3" id="notation-options"></div>
                    
                    <div id="notation-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                    <button onclick="nextNotation()" id="notation-next" class="w-full bg-emerald-200 text-emerald-800 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
                </div>
            </section>
        </div>

        <!-- ==================== SALZE TAB ==================== -->
        <div id="content-salze" class="tab-content space-y-6">
            
            <!-- 1. Verh√§ltnisformel bestimmen -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-pink-500 to-rose-500 p-3 text-white flex justify-between items-center">
                    <h2 class="font-bold flex items-center gap-2"><span>üß™</span> Verh√§ltnisformel</h2>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="formula-score">Richtig: 0</span>
                </div>
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-3 text-center">Wie lautet die Formel des Salzes?</p>
                    
                    <div class="bg-pink-50 p-4 rounded-xl border border-pink-200 mb-4">
                        <div class="flex justify-center items-center gap-4 text-2xl font-bold">
                            <div class="text-center">
                                <div class="text-pink-800" id="formula-cation">Na‚Å∫</div>
                                <div class="text-xs text-pink-500 font-normal">Kation</div>
                            </div>
                            <div class="text-pink-300">+</div>
                            <div class="text-center">
                                <div class="text-pink-800" id="formula-anion">Cl‚Åª</div>
                                <div class="text-xs text-pink-500 font-normal">Anion</div>
                            </div>
                            <div class="text-pink-300">=</div>
                            <div class="text-pink-300 text-3xl">?</div>
                        </div>
                    </div>
                    
                    <div class="hint-box text-sm mb-4">
                        <b>üí° Tipp:</b> Die Summe der Ladungen muss 0 ergeben!
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mb-3" id="formula-options"></div>
                    
                    <div id="formula-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                    <button onclick="nextFormula()" id="formula-next" class="w-full bg-pink-200 text-pink-800 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
                </div>
            </section>

            <!-- 2. Ladungsausgleich -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-500 to-blue-500 p-3 text-white flex justify-between items-center">
                    <h2 class="font-bold flex items-center gap-2"><span>‚öñÔ∏è</span> Ladungsausgleich</h2>
                    <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="balance-score">Richtig: 0</span>
                </div>
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-3 text-center">Wie viele Ionen f√ºr ein neutrales Salz?</p>
                    
                    <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-200 mb-4">
                        <div class="text-center mb-4">
                            <span class="text-xl font-bold text-indigo-800" id="balance-compound">Magnesiumchlorid</span>
                        </div>
                        <div class="flex justify-center items-center gap-6">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-red-600" id="balance-cation-ion">Mg¬≤‚Å∫</div>
                                <input type="number" id="balance-cation-count" min="1" max="9" value="1" class="w-14 h-10 text-center text-xl font-bold border-2 border-indigo-300 rounded-lg mt-2" oninput="updateBalanceTotal()">
                            </div>
                            <div class="text-2xl text-indigo-300">:</div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600" id="balance-anion-ion">Cl‚Åª</div>
                                <input type="number" id="balance-anion-count" min="1" max="9" value="1" class="w-14 h-10 text-center text-xl font-bold border-2 border-indigo-300 rounded-lg mt-2" oninput="updateBalanceTotal()">
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <div class="text-sm text-indigo-600">Gesamtladung: <span id="balance-total" class="font-bold text-red-600">+1</span></div>
                        </div>
                    </div>
                    
                    <button onclick="checkBalance()" class="w-full bg-indigo-600 text-white py-2.5 rounded-lg font-bold tap-active mb-3">Pr√ºfen</button>
                    
                    <div id="balance-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                    <button onclick="nextBalance()" id="balance-next" class="w-full bg-indigo-200 text-indigo-800 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
                </div>
            </section>

            <!-- 3. Salznamen zuordnen -->
            <section class="bg-white rounded-2xl shadow-sm p-4 border-l-4 border-cyan-500">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="font-bold text-slate-800 flex items-center gap-2"><span>üìù</span> Salznamen</h2>
                    <span class="text-xs bg-cyan-100 text-cyan-700 px-2 py-1 rounded font-mono" id="saltname-score">Richtig: 0</span>
                </div>
                <p class="text-sm text-slate-600 mb-3">Welcher Name geh√∂rt zur Formel?</p>
                
                <div class="bg-cyan-50 p-4 rounded-xl border border-cyan-200 text-center mb-4">
                    <div class="text-4xl font-bold font-mono text-cyan-800" id="saltname-formula">NaCl</div>
                </div>
                
                <div class="grid grid-cols-1 gap-2 mb-3" id="saltname-options"></div>
                
                <div id="saltname-feedback" class="hidden p-3 rounded-lg text-sm mb-3"></div>
                <button onclick="nextSaltname()" id="saltname-next" class="w-full bg-cyan-200 text-cyan-800 py-2 rounded-lg font-bold hidden tap-active">Weiter ‚ûú</button>
            </section>
        </div>

        <!-- ==================== CHALLENGE TAB ==================== -->
        <div id="content-challenge" class="tab-content space-y-6">
            
            <!-- Blitzrunde -->
            <section class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="bg-gradient-to-r from-orange-500 to-red-500 p-3 text-white flex justify-between items-center">
                    <h2 class="font-bold flex items-center gap-2"><span>‚ö°</span> Blitzrunde</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="blitz-timer">30s</span>
                        <span class="text-xs bg-white/20 px-2 py-1 rounded font-mono" id="blitz-score">0 Punkte</span>
                    </div>
                </div>
                <div class="p-4">
                    <p class="text-sm text-slate-600 mb-3 text-center">Beantworte so viele Fragen wie m√∂glich!</p>
                    
                    <div class="bg-orange-50 p-4 rounded-xl border border-orange-200 mb-4 text-center">
                        <div class="text-lg font-bold text-orange-800" id="blitz-question">Dr√ºcke Start!</div>
                    </div>
                    
                    <div id="blitz-options" class="grid grid-cols-2 gap-2 mb-3">
                        <button onclick="startBlitz()" id="blitz-start" class="col-span-2 bg-orange-500 text-white py-3 rounded-lg font-bold tap-active text-lg">üöÄ Start!</button>
                    </div>
                    
                    <div id="blitz-result" class="hidden p-4 rounded-lg text-center"></div>
                </div>
            </section>

            <!-- Fortschritt -->
            <section class="bg-white rounded-2xl shadow-sm p-4 border-l-4 border-slate-500">
                <h2 class="font-bold text-slate-800 mb-4 flex items-center gap-2"><span>üìä</span> Dein Fortschritt</h2>
                
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-purple-50 p-3 rounded-xl text-center">
                        <div class="text-2xl font-bold text-purple-600" id="stat-valence">0</div>
                        <div class="text-xs text-purple-500">Valenzelektronen</div>
                    </div>
                    <div class="bg-amber-50 p-3 rounded-xl text-center">
                        <div class="text-2xl font-bold text-amber-600" id="stat-ions">0</div>
                        <div class="text-xs text-amber-500">Ionen</div>
                    </div>
                    <div class="bg-pink-50 p-3 rounded-xl text-center">
                        <div class="text-2xl font-bold text-pink-600" id="stat-formulas">0</div>
                        <div class="text-xs text-pink-500">Formeln</div>
                    </div>
                    <div class="bg-orange-50 p-3 rounded-xl text-center">
                        <div class="text-2xl font-bold text-orange-600" id="stat-blitz">0</div>
                        <div class="text-xs text-orange-500">Blitz-Highscore</div>
                    </div>
                </div>
                
                <button onclick="resetProgress()" class="w-full mt-4 bg-slate-100 text-slate-600 py-2 rounded-lg font-bold tap-active text-sm">Fortschritt zur√ºcksetzen</button>
            </section>
        </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        // ==================== DATEN ====================
        const ELEMENTS = {
            Li: {name: 'Lithium', ordnung: 3, valenz: 1, schalen: [2,1], ionTyp: 'kation', ionLadung: 1, symbol: 'Li‚Å∫'},
            Be: {name: 'Beryllium', ordnung: 4, valenz: 2, schalen: [2,2], ionTyp: 'kation', ionLadung: 2, symbol: 'Be¬≤‚Å∫'},
            O:  {name: 'Sauerstoff', ordnung: 8, valenz: 6, schalen: [2,6], ionTyp: 'anion', ionLadung: 2, symbol: 'O¬≤‚Åª'},
            F:  {name: 'Fluor', ordnung: 9, valenz: 7, schalen: [2,7], ionTyp: 'anion', ionLadung: 1, symbol: 'F‚Åª'},
            Na: {name: 'Natrium', ordnung: 11, valenz: 1, schalen: [2,8,1], ionTyp: 'kation', ionLadung: 1, symbol: 'Na‚Å∫'},
            Mg: {name: 'Magnesium', ordnung: 12, valenz: 2, schalen: [2,8,2], ionTyp: 'kation', ionLadung: 2, symbol: 'Mg¬≤‚Å∫'},
            Al: {name: 'Aluminium', ordnung: 13, valenz: 3, schalen: [2,8,3], ionTyp: 'kation', ionLadung: 3, symbol: 'Al¬≥‚Å∫'},
            S:  {name: 'Schwefel', ordnung: 16, valenz: 6, schalen: [2,8,6], ionTyp: 'anion', ionLadung: 2, symbol: 'S¬≤‚Åª'},
            Cl: {name: 'Chlor', ordnung: 17, valenz: 7, schalen: [2,8,7], ionTyp: 'anion', ionLadung: 1, symbol: 'Cl‚Åª'},
            K:  {name: 'Kalium', ordnung: 19, valenz: 1, schalen: [2,8,8,1], ionTyp: 'kation', ionLadung: 1, symbol: 'K‚Å∫'},
            Ca: {name: 'Calcium', ordnung: 20, valenz: 2, schalen: [2,8,8,2], ionTyp: 'kation', ionLadung: 2, symbol: 'Ca¬≤‚Å∫'},
            Br: {name: 'Brom', ordnung: 35, valenz: 7, schalen: [2,8,18,7], ionTyp: 'anion', ionLadung: 1, symbol: 'Br‚Åª'}
        };

        const EDELGASE = {
            He: {name: 'Helium', elektronen: 2},
            Ne: {name: 'Neon', elektronen: 10},
            Ar: {name: 'Argon', elektronen: 18},
            Kr: {name: 'Krypton', elektronen: 36}
        };

        const SALZE = [
            {kation: 'Na', anion: 'Cl', formel: 'NaCl', name: 'Natriumchlorid', kAnz: 1, aAnz: 1},
            {kation: 'Mg', anion: 'Cl', formel: 'MgCl‚ÇÇ', name: 'Magnesiumchlorid', kAnz: 1, aAnz: 2},
            {kation: 'Ca', anion: 'O', formel: 'CaO', name: 'Calciumoxid', kAnz: 1, aAnz: 1},
            {kation: 'Na', anion: 'O', formel: 'Na‚ÇÇO', name: 'Natriumoxid', kAnz: 2, aAnz: 1},
            {kation: 'Al', anion: 'Cl', formel: 'AlCl‚ÇÉ', name: 'Aluminiumchlorid', kAnz: 1, aAnz: 3},
            {kation: 'Mg', anion: 'O', formel: 'MgO', name: 'Magnesiumoxid', kAnz: 1, aAnz: 1},
            {kation: 'Ca', anion: 'Cl', formel: 'CaCl‚ÇÇ', name: 'Calciumchlorid', kAnz: 1, aAnz: 2},
            {kation: 'K', anion: 'Br', formel: 'KBr', name: 'Kaliumbromid', kAnz: 1, aAnz: 1},
            {kation: 'K', anion: 'Cl', formel: 'KCl', name: 'Kaliumchlorid', kAnz: 1, aAnz: 1},
            {kation: 'Na', anion: 'S', formel: 'Na‚ÇÇS', name: 'Natriumsulfid', kAnz: 2, aAnz: 1}
        ];

        // ==================== STATE ====================
        let state = {
            totalXP: 0,
            valenceScore: 0,
            oktetScore: 0,
            ionTypeScore: 0,
            chargeScore: 0,
            notationScore: 0,
            formulaScore: 0,
            balanceScore: 0,
            saltnameScore: 0,
            blitzHighscore: 0
        };

        // Current task data
        let currentValence = null;
        let currentOktet = null;
        let currentIonType = null;
        let currentCharge = null;
        let currentNotation = null;
        let currentFormula = null;
        let currentBalance = null;
        let currentSaltname = null;
        let matchFirst = null;
        let matchCount = 0;

        // Blitz
        let blitzActive = false;
        let blitzTimer = null;
        let blitzScore = 0;
        let blitzTime = 30;

        // ==================== UTILITIES ====================
        function loadState() {
            try {
                const saved = localStorage.getItem('ionenMasterState');
                if (saved) {
                    state = {...state, ...JSON.parse(saved)};
                }
            } catch(e) {}
            updateAllDisplays();
        }

        function saveState() {
            try {
                localStorage.setItem('ionenMasterState', JSON.stringify(state));
            } catch(e) {}
        }

        function addXP(amount) {
            state.totalXP += amount;
            document.getElementById('total-xp').textContent = state.totalXP;
            saveState();
        }

        function updateAllDisplays() {
            document.getElementById('total-xp').textContent = state.totalXP;
            document.getElementById('valence-score').textContent = 'Richtig: ' + state.valenceScore;
            document.getElementById('oktet-score').textContent = 'Richtig: ' + state.oktetScore;
            document.getElementById('iontype-score').textContent = 'Richtig: ' + state.ionTypeScore;
            document.getElementById('charge-score').textContent = 'Richtig: ' + state.chargeScore;
            document.getElementById('notation-score').textContent = 'Richtig: ' + state.notationScore;
            document.getElementById('formula-score').textContent = 'Richtig: ' + state.formulaScore;
            document.getElementById('balance-score').textContent = 'Richtig: ' + state.balanceScore;
            document.getElementById('saltname-score').textContent = 'Richtig: ' + state.saltnameScore;
            
            document.getElementById('stat-valence').textContent = state.valenceScore;
            document.getElementById('stat-ions').textContent = state.ionTypeScore + state.chargeScore;
            document.getElementById('stat-formulas').textContent = state.formulaScore + state.balanceScore;
            document.getElementById('stat-blitz').textContent = state.blitzHighscore;
        }

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function randomFrom(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // ==================== TAB SWITCHING ====================
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('content-' + tab).classList.add('active');
            
            ['basics', 'ionen', 'salze', 'challenge'].forEach(t => {
                const btn = document.getElementById('btn-' + t);
                if (t === tab) {
                    btn.className = "flex-1 py-2 px-2 rounded-lg bg-white shadow-sm text-blue-600 transition-all tap-active";
                } else {
                    btn.className = "flex-1 py-2 px-2 rounded-lg text-slate-500 transition-all tap-active";
                }
            });
        }

        // ==================== INIT ====================
        window.onload = function() {
            loadState();
            
            // Initialize all tasks
            resetMatching();
            showAtom('Na');
            nextValence();
            nextOktet();
            nextIonType();
            nextCharge();
            nextNotation();
            nextFormula();
            nextBalance();
            nextSaltname();
        };

        // ==================== MATCHING GAME ====================
        function resetMatching() {
            const grid = document.getElementById('match-grid');
            grid.innerHTML = '';
            matchFirst = null;
            matchCount = 0;
            
            const pairs = [
                {el: 'Na', val: '1'},
                {el: 'Mg', val: '2'},
                {el: 'Al', val: '3'},
                {el: 'O', val: '6'},
                {el: 'Cl', val: '7'},
                {el: 'Ca', val: '2'}
            ];
            
            let items = [];
            pairs.forEach(p => {
                // Element button
                const elBtn = document.createElement('button');
                elBtn.className = 'bg-blue-50 p-3 rounded-xl font-bold border-2 border-blue-200 tap-active text-blue-700';
                elBtn.textContent = p.el;
                elBtn.dataset.match = p.el;
                elBtn.onclick = function() { handleMatch(this); };
                items.push(elBtn);
                
                // Value button
                const valBtn = document.createElement('button');
                valBtn.className = 'bg-green-50 p-3 rounded-xl font-bold border-2 border-green-200 tap-active text-green-700';
                valBtn.textContent = p.val + ' e‚Åª';
                valBtn.dataset.match = p.el;
                valBtn.onclick = function() { handleMatch(this); };
                items.push(valBtn);
            });
            
            shuffle(items).forEach(item => grid.appendChild(item));
        }

        function handleMatch(btn) {
            if (btn.disabled) return;
            
            btn.classList.add('ring-2', 'ring-blue-500');
            
            if (!matchFirst) {
                matchFirst = btn;
                return;
            }
            
            if (matchFirst === btn) {
                btn.classList.remove('ring-2', 'ring-blue-500');
                matchFirst = null;
                return;
            }
            
            if (matchFirst.dataset.match === btn.dataset.match) {
                // Correct match
                [matchFirst, btn].forEach(b => {
                    b.classList.remove('ring-2', 'ring-blue-500');
                    b.classList.add('bg-green-200', 'border-green-400', 'opacity-60');
                    b.disabled = true;
                });
                matchCount++;
                addXP(5);
                
                if (matchCount === 6) {
                    addXP(20);
                    confetti({particleCount: 30, spread: 60});
                }
            } else {
                // Wrong match
                [matchFirst, btn].forEach(b => {
                    b.classList.add('bg-red-100', 'border-red-300');
                });
                setTimeout(() => {
                    [matchFirst, btn].forEach(b => {
                        b.classList.remove('ring-2', 'ring-blue-500', 'bg-red-100', 'border-red-300');
                    });
                    matchFirst = null;
                }, 500);
                return;
            }
            
            matchFirst = null;
        }

        // ==================== ATOM VISUALIZATION ====================
        function showAtom(symbol) {
            const el = ELEMENTS[symbol];
            if (!el) return;
            
            document.getElementById('nucleus-label').textContent = symbol;
            document.getElementById('shell-config').textContent = el.schalen.join(' | ');
            
            // Show/hide shells
            const numShells = el.schalen.length;
            document.getElementById('shell1').style.display = numShells >= 1 ? 'block' : 'none';
            document.getElementById('shell2').style.display = numShells >= 2 ? 'block' : 'none';
            document.getElementById('shell3').style.display = numShells >= 3 ? 'block' : 'none';
            document.getElementById('shell4').style.display = numShells >= 4 ? 'block' : 'none';
            
            // Draw electrons
            const container = document.getElementById('electrons-container');
            container.innerHTML = '';
            
            const radii = [35, 52.5, 70, 87.5];
            
            el.schalen.forEach((count, shellIdx) => {
                const radius = radii[shellIdx];
                const isOuter = shellIdx === el.schalen.length - 1;
                
                for (let i = 0; i < count; i++) {
                    const angle = (2 * Math.PI * i / count) - Math.PI / 2;
                    const x = 100 + radius * Math.cos(angle);
                    const y = 100 + radius * Math.sin(angle);
                    
                    const electron = document.createElement('div');
                    electron.className = 'electron' + (isOuter ? ' valence' : '');
                    electron.style.left = x + 'px';
                    electron.style.top = y + 'px';
                    container.appendChild(electron);
                }
            });
            
            // Highlight active button
            document.querySelectorAll('.atom-btn').forEach(b => b.classList.remove('ring-2', 'ring-blue-500'));
        }

        // ==================== VALENCE QUIZ ====================
        function nextValence() {
            document.getElementById('valence-feedback').classList.add('hidden');
            document.getElementById('valence-next').classList.add('hidden');
            
            const symbols = Object.keys(ELEMENTS);
            const symbol = randomFrom(symbols);
            const el = ELEMENTS[symbol];
            
            currentValence = {symbol: symbol, correct: el.valenz};
            
            document.getElementById('valence-element').textContent = symbol;
            document.getElementById('valence-info').textContent = 'Ordnungszahl: ' + el.ordnung;
            
            // Generate options
            let options = [el.valenz];
            while (options.length < 4) {
                const rand = Math.floor(Math.random() * 7) + 1;
                if (!options.includes(rand)) options.push(rand);
            }
            options = shuffle(options);
            
            const container = document.getElementById('valence-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn text-xl';
                btn.textContent = opt;
                btn.onclick = function() { checkValence(opt, this); };
                container.appendChild(btn);
            });
        }

        function checkValence(choice, btn) {
            const fb = document.getElementById('valence-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            document.querySelectorAll('#valence-options button').forEach(b => b.disabled = true);
            
            if (choice === currentValence.correct) {
                fb.classList.add('bg-green-100', 'text-green-800');
                fb.textContent = '‚úÖ Richtig! ' + currentValence.symbol + ' hat ' + choice + ' Au√üenelektron' + (choice > 1 ? 'en' : '') + '.';
                btn.classList.add('correct');
                state.valenceScore++;
                addXP(10);
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Falsch. Richtig: ' + currentValence.correct;
                btn.classList.add('wrong');
            }
            
            updateAllDisplays();
            document.getElementById('valence-next').classList.remove('hidden');
        }

        // ==================== OKTET QUIZ ====================
        function nextOktet() {
            document.getElementById('oktet-feedback').classList.add('hidden');
            document.getElementById('oktet-next').classList.add('hidden');
            
            const edelgasMap = {
                'Li': 'He', 'Na': 'Ne', 'K': 'Ar', 'Mg': 'Ne', 'Ca': 'Ar',
                'Al': 'Ne', 'O': 'Ne', 'S': 'Ar', 'F': 'Ne', 'Cl': 'Ar', 'Br': 'Kr'
            };
            
            const symbols = Object.keys(edelgasMap);
            const symbol = randomFrom(symbols);
            const el = ELEMENTS[symbol];
            const correct = edelgasMap[symbol];
            
            currentOktet = {symbol: symbol, correct: correct};
            
            document.getElementById('oktet-question').innerHTML = '<b>' + el.name + ' (' + symbol + ')</b> hat ' + el.valenz + ' Au√üenelektronen.<br>Welche Edelgaskonfiguration strebt es an?';
            
            const options = shuffle(['He', 'Ne', 'Ar', 'Kr']);
            const container = document.getElementById('oktet-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'bg-white/20 hover:bg-white/30 p-3 rounded-lg font-bold tap-active';
                btn.innerHTML = opt + ' <span class="text-xs opacity-70">(' + EDELGASE[opt].elektronen + ' e‚Åª)</span>';
                btn.onclick = function() { checkOktet(opt, this); };
                container.appendChild(btn);
            });
        }

        function checkOktet(choice, btn) {
            const fb = document.getElementById('oktet-feedback');
            fb.classList.remove('hidden', 'bg-green-500/30', 'bg-red-500/30', 'text-green-200', 'text-red-200');
            
            document.querySelectorAll('#oktet-options button').forEach(b => b.disabled = true);
            
            if (choice === currentOktet.correct) {
                fb.classList.add('bg-green-500/30', 'text-green-200');
                fb.textContent = '‚úÖ Richtig! ' + currentOktet.symbol + ' strebt ' + choice + ' an.';
                btn.classList.add('bg-green-500/40', 'ring-2', 'ring-green-400');
                state.oktetScore++;
                addXP(10);
                confetti({particleCount: 20, spread: 40});
            } else {
                fb.classList.add('bg-red-500/30', 'text-red-200');
                fb.textContent = '‚ùå Falsch. Richtig: ' + currentOktet.correct;
                btn.classList.add('bg-red-500/40');
            }
            
            updateAllDisplays();
            document.getElementById('oktet-next').classList.remove('hidden');
        }

        // ==================== ION TYPE ====================
        function nextIonType() {
            document.getElementById('iontype-feedback').classList.add('hidden');
            document.getElementById('iontype-next').classList.add('hidden');
            document.getElementById('btn-kation').disabled = false;
            document.getElementById('btn-anion').disabled = false;
            document.getElementById('btn-kation').classList.remove('ring-4', 'ring-green-400', 'ring-red-400');
            document.getElementById('btn-anion').classList.remove('ring-4', 'ring-green-400', 'ring-red-400');
            
            const symbols = Object.keys(ELEMENTS);
            const symbol = randomFrom(symbols);
            const el = ELEMENTS[symbol];
            
            currentIonType = {symbol: symbol, correct: el.ionTyp, valenz: el.valenz};
            
            document.getElementById('iontype-element').textContent = symbol;
            document.getElementById('iontype-info').textContent = el.valenz + ' Au√üenelektron' + (el.valenz > 1 ? 'en' : '');
        }

        function checkIonType(choice) {
            const fb = document.getElementById('iontype-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            document.getElementById('btn-kation').disabled = true;
            document.getElementById('btn-anion').disabled = true;
            
            const el = ELEMENTS[currentIonType.symbol];
            
            if (choice === currentIonType.correct) {
                fb.classList.add('bg-green-100', 'text-green-800');
                if (choice === 'kation') {
                    fb.textContent = '‚úÖ Richtig! ' + currentIonType.symbol + ' gibt ' + el.valenz + ' e‚Åª ab ‚Üí ' + el.symbol;
                } else {
                    fb.textContent = '‚úÖ Richtig! ' + currentIonType.symbol + ' nimmt ' + (8 - el.valenz) + ' e‚Åª auf ‚Üí ' + el.symbol;
                }
                document.getElementById('btn-' + choice).classList.add('ring-4', 'ring-green-400');
                state.ionTypeScore++;
                addXP(10);
                confetti({particleCount: 15, spread: 30});
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Falsch. ' + currentIonType.symbol + ' wird zum ' + (currentIonType.correct === 'kation' ? 'Kation (+)' : 'Anion (‚àí)');
                document.getElementById('btn-' + choice).classList.add('ring-4', 'ring-red-400');
            }
            
            updateAllDisplays();
            document.getElementById('iontype-next').classList.remove('hidden');
        }

        // ==================== CHARGE ====================
        function nextCharge() {
            document.getElementById('charge-feedback').classList.add('hidden');
            document.getElementById('charge-next').classList.add('hidden');
            
            const symbols = Object.keys(ELEMENTS);
            const symbol = randomFrom(symbols);
            const el = ELEMENTS[symbol];
            
            const correctCharge = el.ionTyp === 'kation' ? '+' + el.ionLadung : '-' + el.ionLadung;
            currentCharge = {symbol: symbol, correct: correctCharge};
            
            document.getElementById('charge-element').textContent = symbol;
            if (el.ionTyp === 'kation') {
                document.getElementById('charge-info').textContent = el.valenz + ' Au√üenelektronen ‚Üí gibt ' + el.ionLadung + ' e‚Åª ab';
            } else {
                document.getElementById('charge-info').textContent = el.valenz + ' Au√üenelektronen ‚Üí nimmt ' + el.ionLadung + ' e‚Åª auf';
            }
            
            let options = [correctCharge];
            const allCharges = ['+1', '+2', '+3', '-1', '-2', '-3'];
            while (options.length < 4) {
                const rand = randomFrom(allCharges);
                if (!options.includes(rand)) options.push(rand);
            }
            options = shuffle(options);
            
            const container = document.getElementById('charge-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn text-lg ' + (opt.startsWith('+') ? 'text-red-600' : 'text-blue-600');
                btn.textContent = opt;
                btn.onclick = function() { checkCharge(opt, this); };
                container.appendChild(btn);
            });
        }

        function checkCharge(choice, btn) {
            const fb = document.getElementById('charge-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            document.querySelectorAll('#charge-options button').forEach(b => b.disabled = true);
            
            if (choice === currentCharge.correct) {
                fb.classList.add('bg-green-100', 'text-green-800');
                fb.textContent = '‚úÖ Richtig! ' + currentCharge.symbol + ' wird zu ' + ELEMENTS[currentCharge.symbol].symbol;
                btn.classList.add('correct');
                state.chargeScore++;
                addXP(10);
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Falsch. Richtige Ladung: ' + currentCharge.correct;
                btn.classList.add('wrong');
            }
            
            updateAllDisplays();
            document.getElementById('charge-next').classList.remove('hidden');
        }

        // ==================== NOTATION ====================
        function nextNotation() {
            document.getElementById('notation-feedback').classList.add('hidden');
            document.getElementById('notation-next').classList.add('hidden');
            
            const symbols = Object.keys(ELEMENTS);
            const symbol = randomFrom(symbols);
            const el = ELEMENTS[symbol];
            
            const ladungText = el.ionTyp === 'kation' ? '+' + el.ionLadung : '-' + el.ionLadung;
            currentNotation = {symbol: symbol, correct: el.symbol, name: el.name};
            
            document.getElementById('notation-element').textContent = el.name;
            document.getElementById('notation-charge').textContent = ladungText;
            
            // Generate options
            let options = [el.symbol];
            const allSymbols = Object.values(ELEMENTS).map(e => e.symbol);
            while (options.length < 4) {
                const rand = randomFrom(allSymbols);
                if (!options.includes(rand)) options.push(rand);
            }
            options = shuffle(options);
            
            const container = document.getElementById('notation-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn text-xl font-mono';
                btn.textContent = opt;
                btn.onclick = function() { checkNotation(opt, this); };
                container.appendChild(btn);
            });
        }

        function checkNotation(choice, btn) {
            const fb = document.getElementById('notation-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            document.querySelectorAll('#notation-options button').forEach(b => b.disabled = true);
            
            if (choice === currentNotation.correct) {
                fb.classList.add('bg-green-100', 'text-green-800');
                fb.textContent = '‚úÖ Richtig! ' + currentNotation.name + ' ‚Üí ' + currentNotation.correct;
                btn.classList.add('correct');
                state.notationScore++;
                addXP(15);
                confetti({particleCount: 20, spread: 40});
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Falsch. Richtig: ' + currentNotation.correct;
                btn.classList.add('wrong');
            }
            
            updateAllDisplays();
            document.getElementById('notation-next').classList.remove('hidden');
        }

        // ==================== FORMULA ====================
        function nextFormula() {
            document.getElementById('formula-feedback').classList.add('hidden');
            document.getElementById('formula-next').classList.add('hidden');
            
            const salz = randomFrom(SALZE);
            const kEl = ELEMENTS[salz.kation];
            const aEl = ELEMENTS[salz.anion];
            
            currentFormula = {correct: salz.formel, name: salz.name};
            
            document.getElementById('formula-cation').textContent = kEl.symbol;
            document.getElementById('formula-anion').textContent = aEl.symbol;
            
            // Generate options
            let options = [salz.formel];
            const allFormulas = SALZE.map(s => s.formel);
            while (options.length < 4) {
                const rand = randomFrom(allFormulas);
                if (!options.includes(rand)) options.push(rand);
            }
            options = shuffle(options);
            
            const container = document.getElementById('formula-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn text-xl font-mono';
                btn.textContent = opt;
                btn.onclick = function() { checkFormula(opt, this); };
                container.appendChild(btn);
            });
        }

        function checkFormula(choice, btn) {
            const fb = document.getElementById('formula-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            document.querySelectorAll('#formula-options button').forEach(b => b.disabled = true);
            
            if (choice === currentFormula.correct) {
                fb.classList.add('bg-green-100', 'text-green-800');
                fb.textContent = '‚úÖ Richtig! ' + currentFormula.name + ' = ' + currentFormula.correct;
                btn.classList.add('correct');
                state.formulaScore++;
                addXP(15);
                confetti({particleCount: 25, spread: 50});
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Falsch. Richtig: ' + currentFormula.correct;
                btn.classList.add('wrong');
            }
            
            updateAllDisplays();
            document.getElementById('formula-next').classList.remove('hidden');
        }

        // ==================== BALANCE ====================
        function nextBalance() {
            document.getElementById('balance-feedback').classList.add('hidden');
            document.getElementById('balance-next').classList.add('hidden');
            
            const salz = randomFrom(SALZE);
            const kEl = ELEMENTS[salz.kation];
            const aEl = ELEMENTS[salz.anion];
            
            currentBalance = {
                salz: salz,
                kLadung: kEl.ionLadung,
                aLadung: aEl.ionLadung,
                kCorrect: salz.kAnz,
                aCorrect: salz.aAnz
            };
            
            document.getElementById('balance-compound').textContent = salz.name;
            document.getElementById('balance-cation-ion').textContent = kEl.symbol;
            document.getElementById('balance-anion-ion').textContent = aEl.symbol;
            
            document.getElementById('balance-cation-count').value = 1;
            document.getElementById('balance-anion-count').value = 1;
            document.getElementById('balance-cation-count').disabled = false;
            document.getElementById('balance-anion-count').disabled = false;
            
            updateBalanceTotal();
        }

        function updateBalanceTotal() {
            if (!currentBalance) return;
            
            const kCount = parseInt(document.getElementById('balance-cation-count').value) || 1;
            const aCount = parseInt(document.getElementById('balance-anion-count').value) || 1;
            
            const kCharge = currentBalance.kLadung * kCount;
            const aCharge = -currentBalance.aLadung * aCount;
            const total = kCharge + aCharge;
            
            const display = document.getElementById('balance-total');
            display.textContent = total > 0 ? '+' + total : total.toString();
            display.className = 'font-bold ' + (total === 0 ? 'text-green-600' : 'text-red-600');
        }

        function checkBalance() {
            if (!currentBalance) return;
            
            const kCount = parseInt(document.getElementById('balance-cation-count').value) || 1;
            const aCount = parseInt(document.getElementById('balance-anion-count').value) || 1;
            
            const fb = document.getElementById('balance-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            if (kCount === currentBalance.kCorrect && aCount === currentBalance.aCorrect) {
                fb.classList.add('bg-green-100', 'text-green-800');
                fb.textContent = '‚úÖ Perfekt! ' + kCount + ':' + aCount + ' ergibt ' + currentBalance.salz.formel;
                state.balanceScore++;
                addXP(20);
                confetti({particleCount: 30, spread: 60});
                document.getElementById('balance-cation-count').disabled = true;
                document.getElementById('balance-anion-count').disabled = true;
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Nicht ausgeglichen. Richtig: ' + currentBalance.kCorrect + ':' + currentBalance.aCorrect;
            }
            
            updateAllDisplays();
            document.getElementById('balance-next').classList.remove('hidden');
        }

        // ==================== SALTNAME ====================
        function nextSaltname() {
            document.getElementById('saltname-feedback').classList.add('hidden');
            document.getElementById('saltname-next').classList.add('hidden');
            
            const salz = randomFrom(SALZE);
            currentSaltname = {correct: salz.name, formel: salz.formel};
            
            document.getElementById('saltname-formula').textContent = salz.formel;
            
            // Generate options
            let options = [salz.name];
            const allNames = SALZE.map(s => s.name);
            while (options.length < 4) {
                const rand = randomFrom(allNames);
                if (!options.includes(rand)) options.push(rand);
            }
            options = shuffle(options);
            
            const container = document.getElementById('saltname-options');
            container.innerHTML = '';
            
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = function() { checkSaltname(opt, this); };
                container.appendChild(btn);
            });
        }

        function checkSaltname(choice, btn) {
            const fb = document.getElementById('saltname-feedback');
            fb.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
            
            document.querySelectorAll('#saltname-options button').forEach(b => b.disabled = true);
            
            if (choice === currentSaltname.correct) {
                fb.classList.add('bg-green-100', 'text-green-800');
                fb.textContent = '‚úÖ Richtig! ' + currentSaltname.formel + ' = ' + currentSaltname.correct;
                btn.classList.add('correct');
                state.saltnameScore++;
                addXP(10);
            } else {
                fb.classList.add('bg-red-100', 'text-red-800');
                fb.textContent = '‚ùå Falsch. Richtig: ' + currentSaltname.correct;
                btn.classList.add('wrong');
            }
            
            updateAllDisplays();
            document.getElementById('saltname-next').classList.remove('hidden');
        }

        // ==================== BLITZ ====================
        const BLITZ_QUESTIONS = [
            {q: 'Au√üenelektronen von Na?', a: '1', opts: ['1', '2', '7', '8']},
            {q: 'Au√üenelektronen von Cl?', a: '7', opts: ['1', '5', '7', '8']},
            {q: 'Ladung von Na-Ion?', a: '+1', opts: ['+1', '+2', '-1', '-2']},
            {q: 'Ladung von O-Ion?', a: '-2', opts: ['+2', '-1', '-2', '-3']},
            {q: 'Na wird zum...?', a: 'Kation', opts: ['Kation', 'Anion']},
            {q: 'Cl wird zum...?', a: 'Anion', opts: ['Kation', 'Anion']},
            {q: 'Formel: Na + Cl?', a: 'NaCl', opts: ['NaCl', 'Na‚ÇÇCl', 'NaCl‚ÇÇ']},
            {q: 'Mg-Ion hat Ladung...?', a: '+2', opts: ['+1', '+2', '+3', '-2']},
            {q: 'Oktettregel: wie viele e‚Åª?', a: '8', opts: ['2', '6', '8', '10']},
            {q: 'Ca wird zum...?', a: 'Kation', opts: ['Kation', 'Anion']},
            {q: 'Au√üenelektronen von Mg?', a: '2', opts: ['1', '2', '3', '6']},
            {q: 'Formel: Mg + O?', a: 'MgO', opts: ['MgO', 'Mg‚ÇÇO', 'MgO‚ÇÇ']},
            {q: 'Al-Ion hat Ladung...?', a: '+3', opts: ['+1', '+2', '+3', '-3']},
            {q: 'Au√üenelektronen von O?', a: '6', opts: ['2', '4', '6', '8']}
        ];

        function startBlitz() {
            blitzActive = true;
            blitzScore = 0;
            blitzTime = 30;
            
            document.getElementById('blitz-score').textContent = '0 Punkte';
            document.getElementById('blitz-timer').textContent = '30s';
            document.getElementById('blitz-result').classList.add('hidden');
            
            nextBlitzQuestion();
            
            blitzTimer = setInterval(function() {
                blitzTime--;
                document.getElementById('blitz-timer').textContent = blitzTime + 's';
                
                if (blitzTime <= 0) {
                    endBlitz();
                }
            }, 1000);
        }

        function nextBlitzQuestion() {
            if (!blitzActive) return;
            
            const q = randomFrom(BLITZ_QUESTIONS);
            document.getElementById('blitz-question').textContent = q.q;
            
            const container = document.getElementById('blitz-options');
            container.innerHTML = '';
            
            shuffle(q.opts).forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'bg-orange-100 border-2 border-orange-300 hover:border-orange-500 p-3 rounded-lg font-bold tap-active';
                btn.textContent = opt;
                btn.onclick = function() { checkBlitz(opt, q.a); };
                container.appendChild(btn);
            });
        }

        function checkBlitz(choice, correct) {
            if (!blitzActive) return;
            
            if (choice === correct) {
                blitzScore++;
                document.getElementById('blitz-score').textContent = blitzScore + ' Punkte';
            }
            
            setTimeout(nextBlitzQuestion, 200);
        }

        function endBlitz() {
            blitzActive = false;
            clearInterval(blitzTimer);
            
            document.getElementById('blitz-question').textContent = 'Zeit vorbei!';
            document.getElementById('blitz-options').innerHTML = '<button onclick="startBlitz()" class="col-span-2 bg-orange-500 text-white py-3 rounded-lg font-bold tap-active text-lg">üîÑ Nochmal!</button>';
            
            const result = document.getElementById('blitz-result');
            result.classList.remove('hidden');
            result.className = 'p-4 rounded-lg text-center bg-orange-100 text-orange-800';
            result.innerHTML = '<div class="text-2xl font-bold">' + blitzScore + ' Punkte!</div>';
            
            if (blitzScore > state.blitzHighscore) {
                state.blitzHighscore = blitzScore;
                result.innerHTML += '<div class="text-sm mt-1">üèÜ Neuer Highscore!</div>';
                confetti({particleCount: 50, spread: 80});
            }
            
            addXP(blitzScore);
            updateAllDisplays();
        }

        // ==================== RESET ====================
        function resetProgress() {
            if (confirm('Wirklich alles zur√ºcksetzen?')) {
                localStorage.removeItem('ionenMasterState');
                state = {
                    totalXP: 0, valenceScore: 0, oktetScore: 0, ionTypeScore: 0,
                    chargeScore: 0, notationScore: 0, formulaScore: 0, balanceScore: 0,
                    saltnameScore: 0, blitzHighscore: 0
                };
                updateAllDisplays();
            }
        }
    </script>
</body>
</html>
